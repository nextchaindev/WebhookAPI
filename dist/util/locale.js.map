{"version":3,"file":"locale.js","sourceRoot":"/","sources":["util/locale.ts"],"names":[],"mappings":"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","sourcesContent":["import lodash from 'lodash';\nimport moment from 'moment';\nimport M from 'mustache';\nimport path from 'path';\n\nimport { logger } from '../logger';\nimport { iterateFolder } from '.';\n\nexport interface LocaleModule {\n  (string: string, params?: Record<string, string>): string;\n  valid(string: string): boolean;\n  numSuffix(string: string, value: number, params: Record<string, string>): string;\n  toLocaleString(number: number): string;\n  moment(...args: any[]): moment.Moment;\n  locale: string;\n  json(): any;\n}\n\nexport const locales = new Map<string, any>();\nexport const load = () => iterateFolder(path.join(__dirname, '../../locale/bot'), loadFile, '.json');\n\nexport function loadFile(filePath: string) {\n  logger.log('Loading locale', filePath);\n  // eslint-disable-next-line @typescript-eslint/no-var-requires\n  const json = require(filePath);\n  locales.set(path.parse(filePath).name, json);\n}\n\nexport const sourceLocale = 'en_US';\nexport function source() {\n  return locales.get('en_US');\n}\n\nexport function toArray() {\n  const array = [];\n  locales.forEach((json, locale) => array.push([locale, json]));\n  return array;\n}\n\nexport function toModule(locale: string): LocaleModule {\n  locale = locale || sourceLocale;\n  const _ = (string: string, params: Record<string, string> = {}) => {\n    const localeJSON = locales.get(locale);\n    const source = locales.get(sourceLocale);\n    const localeBase = localeJSON ? lodash.defaultsDeep(localeJSON, source) : source;\n    const localeString = lodash.get(localeBase, string);\n    if (!localeString) throw new Error(`No string named '${string}' was found in the source translation.`);\n    return M.render(localeString, params);\n  };\n\n  _.valid = (string: string): boolean => {\n    const localeJSON = locales.get(locale);\n    const source = locales.get(sourceLocale);\n    const localeBase = localeJSON ? lodash.defaultsDeep(localeJSON, source) : source;\n    return lodash.has(localeBase, string);\n  };\n\n  _.numSuffix = (string: string, value: number, params: Record<string, string>) => {\n    const suffixTable: [number, string][] = [\n      [0, 'zero'],\n      [1, 'one'],\n      [2, 'two'],\n      [3, 'three'],\n      [4, 'four'],\n      [5, 'five']\n    ];\n\n    for (const [num, suffix] of suffixTable) {\n      if (value !== num) continue;\n      if (_.valid(`${string}.${suffix}`)) return _(`${string}.${suffix}`, params);\n    }\n\n    return _(`${string}.many`, params);\n  };\n\n  _.toLocaleString = (number: number) => number.toLocaleString(locale.replace('_', '-'));\n\n  _.moment = (...args: any[]) => moment(...args).locale(locale.replace('_', '-'));\n\n  _.locale = locale;\n\n  _.json = () => {\n    const localeJSON = locales.get(locale);\n    const source = locales.get(sourceLocale);\n    const localeBase = localeJSON ? lodash.defaultsDeep(localeJSON, source) : source;\n    return localeBase;\n  };\n\n  return _;\n}\n"]}