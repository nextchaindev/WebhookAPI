{"version":3,"file":"batcher.js","sourceRoot":"/","sources":["util/batcher.ts"],"names":[],"mappings":";;;AAAA,0EAAyC;AAOzC,MAAqB,OAAiB,SAAQ,uBAAY;IAQxD,YAAY,OAAuB;QACjC,KAAK,EAAE,CAAC;QAHF,SAAI,GAAQ,EAAE,CAAC;QAIrB,IAAI,CAAC,OAAO,GAAG,OAAO,CAAC,OAAO,CAAC;QAC/B,IAAI,CAAC,OAAO,GAAG,OAAO,CAAC,OAAO,CAAC;QAE/B,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,GAAG,EAAE,CAAC;IAC/B,CAAC;IAED,MAAM;QACJ,YAAY,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;QAC5B,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,GAAG,EAAE,CAAC;QAE7B,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC;QAC9B,IAAI,CAAC,IAAI,GAAG,EAAE,CAAC;IACjB,CAAC;IAED,GAAG,CAAC,IAAO;QACT,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAErB,IAAI,IAAI,CAAC,IAAI,CAAC,MAAM,KAAK,IAAI,CAAC,OAAO,EAAE;YACrC,IAAI,CAAC,MAAM,EAAE,CAAC;SACf;aAAM,IAAI,IAAI,CAAC,OAAO,IAAI,IAAI,IAAI,IAAI,CAAC,IAAI,CAAC,MAAM,KAAK,CAAC,EAAE;YACzD,IAAI,CAAC,QAAQ,GAAG,UAAU,CAAC,GAAG,EAAE;gBAC9B,OAAO,IAAI,CAAC,MAAM,EAAE,CAAC;YACvB,CAAC,EAAE,IAAI,CAAC,OAAO,CAAC,CAAC;SAClB;IACH,CAAC;CACF;AAnCD,0BAmCC","sourcesContent":["import EventEmitter from 'eventemitter3';\n\nexport interface BatcherOptions {\n  maxSize: number;\n  maxTime: number;\n}\n\nexport default class Batcher<T = any> extends EventEmitter {\n  maxTime: number;\n  maxSize: number;\n\n  private _lastFlush: number;\n  private _timeout: NodeJS.Timeout;\n  private _arr: T[] = [];\n\n  constructor(options: BatcherOptions) {\n    super();\n    this.maxTime = options.maxTime;\n    this.maxSize = options.maxSize;\n\n    this._lastFlush = Date.now();\n  }\n\n  _flush() {\n    clearTimeout(this._timeout);\n    this._lastFlush = Date.now();\n\n    this.emit('batch', this._arr);\n    this._arr = [];\n  }\n\n  add(data: T) {\n    this._arr.push(data);\n\n    if (this._arr.length === this.maxSize) {\n      this._flush();\n    } else if (this.maxTime != null && this._arr.length === 1) {\n      this._timeout = setTimeout(() => {\n        return this._flush();\n      }, this.maxTime);\n    }\n  }\n}\n"]}