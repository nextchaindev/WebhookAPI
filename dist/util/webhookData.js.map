{"version":3,"file":"webhookData.js","sourceRoot":"/","sources":["util/webhookData.ts"],"names":[],"mappings":"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","sourcesContent":["import { captureException } from '@sentry/node';\nimport { FastifyRequest } from 'fastify';\nimport lodash from 'lodash';\n\nimport { cardListMapCache } from '../cache';\nimport { onWebhookSend } from '../db/influx';\nimport { Webhook } from '../db/postgres';\nimport { available as redisAvailable, batchHandoffs, client, subClient } from '../db/redis';\nimport { logger } from '../logger';\nimport { cutoffText, escapeMarkdown, isEmpty } from '.';\nimport Batcher, { BatcherOptions } from './batcher';\nimport * as locale from './locale';\nimport { request } from './request';\nimport {\n  TrelloBoard,\n  TrelloCard,\n  TrelloCardSource,\n  TrelloLabel,\n  TrelloList,\n  TrelloPayload,\n  TrelloUser\n} from './types';\n\nexport const batches = new Map<string, Batcher>();\n\nexport interface TemporaryBatcherOptions<T = any> extends BatcherOptions {\n  onBatch(arr: T[]): any;\n}\n\nasync function createTemporaryBatcher<T = any>(id: string, data: T, options: TemporaryBatcherOptions<T>) {\n  if (redisAvailable) {\n    const count = await client.publish(`batch_handoff:${id}`, JSON.stringify(data));\n    if (count > 0) {\n      logger.log(`Batch ${id} passed off to ${count} clients.`);\n      return;\n    }\n  }\n\n  if (batches.has(id)) return batches.get(id).add(data);\n\n  const batcher = new Batcher<T>(options);\n  batches.set(id, batcher);\n  batcher.on('batch', async (arr) => {\n    batches.delete(id);\n    if (redisAvailable) {\n      batchHandoffs.delete(id);\n      await subClient.unsubscribe(`batch_handoff:${id}`);\n    }\n    return options.onBatch(arr);\n  });\n  batcher.add(data);\n\n  if (redisAvailable) {\n    batchHandoffs.set(id, batcher);\n    await subClient.subscribe(`batch_handoff:${id}`);\n  }\n}\n\ninterface ExtendedTrelloUser extends TrelloUser {\n  avatar?: string | null;\n  webhookSafeName?: string;\n}\n\nexport default class WebhookData {\n  request: FastifyRequest;\n  webhook: Webhook;\n  locale: locale.LocaleModule;\n  /** The filter flag this is representing */\n  filterFlag: string;\n\n  constructor(request: FastifyRequest, webhook: Webhook, filterFlag: string) {\n    this.request = request;\n    this.webhook = webhook;\n\n    this.filterFlag = filterFlag;\n    this.locale = locale.toModule(this.webhook.locale);\n  }\n\n  /**\n   * Whether the request is representing a child action\n   */\n  isChildAction() {\n    return (\n      this.action.type.replace(/[A-Z]/g, (letter: string) => `_${letter.toLowerCase()}`).toUpperCase() !==\n      this.filterFlag\n    );\n  }\n\n  /**\n   * The body of the request\n   */\n  get body() {\n    return this.request.body as TrelloPayload<any>;\n  }\n\n  /**\n   * The model that this action is for\n   */\n  get model() {\n    return this.body.model;\n  }\n\n  /**\n   * The action data\n   */\n  get action() {\n    return this.body.action;\n  }\n\n  /**\n   * The user who started the event\n   */\n  get invoker() {\n    const member = this.action.memberCreator;\n    const name = this.action.display?.entities?.memberCreator?.text ?? member.fullName;\n    return {\n      avatar: member.avatarUrl ? member.avatarUrl + '/170.png' : null,\n      webhookSafeName: !isEmpty(name) ? cutoffText(name, 50) : member.username,\n      titleSafeName: !isEmpty(name) ? cutoffText(name, 256) : member.username,\n      ...member\n    };\n  }\n\n  // #region action data shorthands\n  /**\n   * The old data from the action\n   */\n  get oldData() {\n    return this.action.data.old;\n  }\n\n  /**\n   * The board represented from the action\n   */\n  get board(): TrelloBoard {\n    return this.action.data.board;\n  }\n\n  /**\n   * The target board represented from the action\n   */\n  get targetBoard() {\n    return this.action.data.boardTarget;\n  }\n\n  /**\n   * The source board represented from the action\n   */\n  get sourceBoard() {\n    return this.action.data.boardSource;\n  }\n\n  /**\n   * The label represented from the action\n   */\n  get label(): TrelloLabel {\n    return this.action.data.label;\n  }\n\n  /**\n   * The attachment represented from the action\n   */\n  get attachment() {\n    return this.action.data.attachment;\n  }\n\n  /**\n   * The member represented from the action\n   */\n  get member(): ExtendedTrelloUser {\n    const member = this.action.member;\n    const name = this.action.display?.entities?.member?.text ?? member?.fullName;\n    return member\n      ? {\n          avatar: member.avatarUrl ? member.avatarUrl + '/170.png' : null,\n          webhookSafeName: !isEmpty(name) ? cutoffText(name, 50) : member.username,\n          ...member\n        }\n      : member;\n  }\n\n  /**\n   * The card represented from the action\n   */\n  get card(): TrelloCard {\n    return this.action.data.card;\n  }\n\n  /**\n   * The source card represented from the action\n   */\n  get sourceCard(): TrelloCardSource {\n    return this.action.data.cardSource;\n  }\n\n  /**\n   * The list represented from the action\n   */\n  get list(): TrelloList {\n    return this.action.data.list;\n  }\n\n  /**\n   * The list before represented from the action\n   */\n  get listBefore() {\n    return this.action.data.listBefore;\n  }\n\n  /**\n   * The list after represented from the action\n   */\n  get listAfter() {\n    return this.action.data.listAfter;\n  }\n\n  /**\n   * The checklist represented from the action\n   */\n  get checklist() {\n    return this.action.data.checklist;\n  }\n\n  /**\n   * The source checklist represented from the action\n   */\n  get sourceChecklist() {\n    return this.action.data.checklistSource;\n  }\n\n  /**\n   * The checklist item represented from the action\n   */\n  get checklistItem() {\n    return this.action.data.checkItem;\n  }\n\n  /**\n   * The custom field represented from the action\n   */\n  get customField() {\n    return this.action.data.customField;\n  }\n\n  /**\n   * The custom field item represented from the action\n   */\n  get customFieldItem() {\n    return this.action.data.customFieldItem;\n  }\n  // #endregion\n\n  embedDescription(fields = null) {\n    const _ = this.locale;\n    const lines = {\n      invoker: `**${_('words.member.one')}:** [${\n        this.invoker.fullName\n          ? `${cutoffText(this.invoker.fullName, 50)} (${this.invoker.username})`\n          : this.invoker.username\n      }](https://trello.com/${this.invoker.username}?utm_source=tacobot.app)`,\n      member: this.member\n        ? `**${_('words.member.one')}:** [${\n            this.member.fullName\n              ? `${cutoffText(this.member.fullName, 50)} (${this.member.username})`\n              : this.member.username\n          }](https://trello.com/${this.member.username}?utm_source=tacobot.app)`\n        : '',\n      card:\n        this.card && this.card.name\n          ? `**${_('words.card.one')}:** [${cutoffText(\n              escapeMarkdown(this.card.name),\n              50\n            )}](https://trello.com/c/${this.card.shortLink}?utm_source=tacobot.app)`\n          : '',\n      list:\n        this.list && this.list.name\n          ? `**${_('words.list.one')}:** ${cutoffText(escapeMarkdown(this.list.name), 50)}`\n          : '',\n      listBefore: this.listBefore\n        ? `**${_('trello.prev_list')}:** ${cutoffText(escapeMarkdown(this.listBefore.name), 50)}`\n        : '',\n      listAfter: this.listAfter\n        ? `**${_('trello.curr_list')}:** ${cutoffText(escapeMarkdown(this.listAfter.name), 50)}`\n        : '',\n      checklist:\n        this.checklist && this.checklist.name\n          ? `**${_('words.checklist.one')}:** ${cutoffText(escapeMarkdown(this.checklist.name), 50)}`\n          : '',\n      checklistItem:\n        this.checklistItem && this.checklistItem.name\n          ? `**${_('words.checklist_item.one')}:** ${cutoffText(escapeMarkdown(this.checklistItem.name), 50)}`\n          : '',\n      customField:\n        this.customField && this.customField.type\n          ? `**${_('trello.custom_field')} (${_(\n              `custom_field_types.${this.customField.type}`\n            )}):** ${cutoffText(escapeMarkdown(this.customField.name), 50)}`\n          : '',\n      label:\n        this.label && this.label.name\n          ? `**${_('words.label.one')}${\n              this.label.color ? ` (${_(`trello.label_color.${this.label.color}`)})` : ''\n            }:** ${cutoffText(escapeMarkdown(this.label.name), 50)}`\n          : '',\n      attachment:\n        this.attachment && this.attachment.name\n          ? `**${_('words.attachment.one')}:** ${\n              this.attachment.url\n                ? `[${cutoffText(escapeMarkdown(this.attachment.name), 50)}](${this.attachment.url})`\n                : cutoffText(escapeMarkdown(this.attachment.name), 50)\n            }`\n          : ''\n    };\n    if (!fields) fields = Object.keys(lines);\n    return fields\n      .map((f: string | number) => lines[f])\n      .filter((v: any) => !!v)\n      .join('\\n');\n  }\n\n  /**\n   * Sends the embed to the webhook\n   * @param {Object<string, Object>} embedStyles The embeds for each style\n   */\n  async send(embedStyles: Record<string, any>) {\n    // Update card-list pairing cache\n    if (this.card && (this.list || this.listAfter))\n      cardListMapCache.set(this.card.id, [Date.now(), this.list ? this.list.id : this.listAfter.id]);\n\n    const EMBED_DEFAULTS = {\n      default: {\n        color: this.isChildAction() ? DEFAULT_COLORS.CHILD : DEFAULT_COLORS[this.filterFlag.split('_')[0]],\n        author: {\n          icon_url: process.env.TRELLO_ICON_URL,\n          name: 'Trello: ' + cutoffText(this.model.name, 248),\n          url: `${this.model.url}?utm_source=tacobot.app`\n        },\n        description: embedStyles.default.description || this.embedDescription(),\n        ...(this.invoker.avatar\n          ? {\n              thumbnail: { url: this.invoker.avatar }\n            }\n          : {}),\n        timestamp: this.action.date,\n        footer: {\n          icon_url: 'https://tacobot.app/logo_happy.png',\n          text: 'nextchain.kr'\n        }\n      },\n      small: {\n        color: this.isChildAction() ? DEFAULT_COLORS.CHILD : DEFAULT_COLORS[this.filterFlag.split('_')[0]],\n        author: {\n          ...(this.invoker.avatar\n            ? {\n                icon_url: this.invoker.avatar\n              }\n            : {}),\n          name: this.invoker.titleSafeName,\n          url: `${this.model.url}?utm_source=tacobot.app`\n        },\n        url: `${this.model.url}?utm_source=tacobot.app`,\n        title: cutoffText(this.model.name, 256),\n        timestamp: this.action.date,\n        footer: {\n          icon_url: 'https://tacobot.app/logo_happy.png',\n          text: 'nextchain.kr'\n        }\n      },\n      compact: {\n        color: 3092790,\n        author: {\n          icon_url: process.env.TRELLO_ICON_URL,\n          name: 'Trello: ' + cutoffText(this.model.name, 248),\n          url: this.model.url\n        },\n        timestamp: this.action.date,\n        footer: {\n          icon_url: 'https://tacobot.app/logo_happy.png',\n          text: 'nextchain.kr'\n        }\n      }\n    };\n\n    if (this.webhook.style === 'compact') {\n      const batchKey = `compact:${this.model.id}:${this.webhook.webhookID}`;\n      const compactLine = `\\`${\n        this.isChildAction() ? COMPACT_EMOJIS.CHILD : COMPACT_EMOJIS[this.filterFlag.split('_')[0]]\n      }\\` ${embedStyles.small.description}`;\n\n      createTemporaryBatcher(batchKey, compactLine, {\n        maxTime: 2000,\n        maxSize: 10,\n        onBatch: (lines) => {\n          createTemporaryBatcher(\n            this.webhook.webhookID,\n            lodash.defaultsDeep({ description: lines.join('\\n') }, EMBED_DEFAULTS.compact),\n            {\n              maxTime: 1000,\n              maxSize: 10,\n              onBatch: (embeds) => {\n                onWebhookSend(this.webhook.webhookID);\n                logger.info(\n                  'Posting webhook %s (guild=%s, time=%d)',\n                  this.webhook.webhookID,\n                  this.webhook.guildID,\n                  Date.now()\n                );\n                return this._send(embeds);\n              }\n            }\n          );\n        }\n      });\n      return;\n    }\n\n    return createTemporaryBatcher(\n      this.webhook.webhookID,\n      lodash.defaultsDeep(embedStyles[this.webhook.style], EMBED_DEFAULTS[this.webhook.style]),\n      {\n        maxTime: 1000,\n        maxSize: 10,\n        onBatch: (embeds) => {\n          onWebhookSend(this.webhook.webhookID);\n          logger.info(\n            'Posting webhook %s (guild=%s, time=%d)',\n            this.webhook.webhookID,\n            this.webhook.guildID,\n            Date.now()\n          );\n          return this._send(embeds);\n        }\n      }\n    );\n  }\n\n  private async _send(embeds: any[], attempt = 5) {\n    try {\n      console.debug('Discord webhook', JSON.stringify(embeds));\n      await request(\n        'POST',\n        `/webhooks/${this.webhook.webhookID}/${this.webhook.webhookToken}?thread_id=${this.webhook.threadID}`,\n        {\n          embeds,\n          avatar_url: process.env.COMPANY_LOGO_URL\n        }\n      );\n    } catch (e) {\n      if (e.name.startsWith('DiscordRESTError')) {\n        if (e.code === 10015) {\n          logger.warn(`Discord webhook lost @ ${this.webhook.webhookID}:${this.webhook.id}`, e);\n          await Webhook.update(\n            {\n              webhookID: null,\n              webhookToken: null\n            },\n            { where: { id: this.webhook.id } }\n          );\n        } else if (e.code === 50027) {\n          logger.warn(\n            `Discord webhook token invalid, dropping @ ${this.webhook.webhookID}:${this.webhook.id}`,\n            e\n          );\n          await Webhook.update(\n            {\n              webhookID: null,\n              webhookToken: null\n            },\n            { where: { id: this.webhook.id } }\n          );\n        } else if (e.status === 400) {\n          logger.error(\n            `Invalid form body, dropping @ ${this.webhook.webhookID}:${this.webhook.id} - ${this.filterFlag}`,\n            e\n          );\n        } else {\n          attempt++;\n          if (attempt > 3) {\n            logger.error(\n              `Discord Error ${e.code} (${e.status}), exceeded attempts, dropping @ ${this.webhook.webhookID}:${this.webhook.id}`,\n              e\n            );\n          } else {\n            logger.warn(\n              `Discord Error ${e.code} (${e.status}), retrying (${attempt}) @ ${this.webhook.webhookID}:${this.webhook.id}`\n            );\n            return this._send(embeds, attempt);\n          }\n        }\n      } else if (e.name === 'DiscordHTTPError' && e.code >= 500) {\n        attempt++;\n        if (attempt < 3) {\n          logger.error(\n            `Discord server error, exceeded attempts, dropping @ ${this.webhook.webhookID}:${this.webhook.id}`\n          );\n        } else {\n          logger.warn(\n            `Discord server error, retrying (${attempt}) @ ${this.webhook.webhookID}:${this.webhook.id}`\n          );\n          return this._send(embeds, attempt);\n        }\n      } else if (e.message.startsWith('Request timed out (>15000ms)')) {\n        attempt++;\n        if (attempt < 3) {\n          logger.error(\n            `Request timed out, exceeded attempts, dropping @ ${this.webhook.webhookID}:${this.webhook.id}`\n          );\n        } else {\n          logger.warn(\n            `Request timed out, retrying (${attempt}) @ ${this.webhook.webhookID}:${this.webhook.id}`\n          );\n          return this._send(embeds, attempt);\n        }\n      } else {\n        captureException(e, {\n          tags: {\n            webhook: this.webhook.id,\n            discordWebhook: this.webhook.webhookID\n          }\n        });\n        logger.error(`Webhook execution failed @ ${this.webhook.webhookID}:${this.webhook.id}`, e);\n      }\n    }\n  }\n}\n\nexport const DEFAULT_COLORS = {\n  ADD: 0x2ecc71,\n  CREATE: 0x16a085,\n  UPDATE: 0xe67e22,\n  CHILD: 0xf1c40f,\n  UNCONFIRMED: 0xf1c40f,\n  REMOVE: 0xe74c3c,\n  DELETE: 0xc0392b,\n  ENABLE: 0x95a5a6,\n  DISABLE: 0x34495e,\n  MAKE: 0x3498db,\n  MEMBER: 0x3498db,\n  VOTE: 0x2980b9,\n  EMAIL: 0xecf0f1,\n  COMMENT: 0xff9f43,\n  CONVERT: 0x9b59b6,\n  COPY: 0xf19066,\n  MOVE: 0xb53471\n};\n\nexport const COMPACT_EMOJIS = {\n  ADD: '🟢',\n  CREATE: '🟩',\n  UPDATE: '🟧',\n  CHILD: '🟡',\n  UNCONFIRMED: '🟠',\n  REMOVE: '🔴',\n  DELETE: '🟥',\n  ENABLE: '✅',\n  DISABLE: '❎',\n  MAKE: '🟦',\n  MEMBER: '🔵',\n  VOTE: '🗳️',\n  EMAIL: '📧',\n  COMMENT: '💬',\n  CONVERT: '📇',\n  COPY: '📋',\n  MOVE: '📦'\n};\n"]}