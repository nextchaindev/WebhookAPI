{"version":3,"file":"DiscordRESTError.js","sourceRoot":"/","sources":["util/request/DiscordRESTError.ts"],"names":[],"mappings":";;AAGA,MAAM,gBAAiB,SAAQ,KAAK;IAsBlC,YAAY,GAAkB,EAAE,GAAoB,EAAE,QAAa,EAAE,KAAa;QAChF,KAAK,EAAE,CAAC;QAER,IAAI,CAAC,GAAG,GAAG,GAAG,CAAC;QACf,IAAI,CAAC,GAAG,GAAG,GAAG,CAAC;QACf,IAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC;QACzB,IAAI,CAAC,MAAM,GAAG,GAAG,CAAC,UAAoB,CAAC;QACvC,IAAI,CAAC,IAAI,GAAI,QAAQ,CAAC,IAAe,IAAI,CAAC,CAAC;QAE3C,IAAI,OAAO,GAAG,QAAQ,CAAC,OAAO,IAAI,eAAe,CAAC;QAClD,IAAI,QAAQ,CAAC,MAAM;YAAE,OAAO,IAAI,MAAM,GAAG,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;aACrF;YACH,MAAM,MAAM,GAAG,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;YAC5C,IAAI,MAAM,CAAC,MAAM,GAAG,CAAC;gBAAE,OAAO,IAAI,MAAM,GAAG,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;SAChE;QACD,IAAI,CAAC,OAAO,GAAG,OAAO,CAAC;QAEvB,IAAI,KAAK;YAAE,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,IAAI,GAAG,IAAI,GAAG,IAAI,CAAC,OAAO,GAAG,IAAI,GAAG,KAAK,CAAC;aAClE;YAEH,IAAI,CAAC,KAAK,GAAG,EAAE,CAAC;YAChB,KAAK,CAAC,iBAAiB,CAAC,IAAI,EAAE,gBAAgB,CAAC,CAAC;SACjD;IACH,CAAC;IAED,IAAI,IAAI;QACN,OAAO,GAAG,IAAI,CAAC,WAAW,CAAC,IAAI,KAAK,IAAI,CAAC,IAAI,GAAG,CAAC;IACnD,CAAC;IAEO,aAAa,CAAC,MAAW,EAAE,SAAS,GAAG,EAAE;QAC/C,IAAI,QAAQ,GAAa,EAAE,CAAC;QAC5B,KAAK,MAAM,SAAS,IAAI,MAAM,EAAE;YAC9B,IAAI,CAAC,CAAC,SAAS,IAAI,MAAM,CAAC,IAAI,SAAS,KAAK,SAAS,IAAI,SAAS,KAAK,MAAM,EAAE;gBAC7E,SAAS;aACV;YACD,IAAI,MAAM,CAAC,SAAS,CAAC,CAAC,OAAO,EAAE;gBAC7B,QAAQ,GAAG,QAAQ,CAAC,MAAM,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC,GAAQ,EAAE,EAAE,CAAC,GAAG,SAAS,GAAG,SAAS,KAAK,GAAG,CAAC,OAAO,EAAE,CAAC,CAAC,CAAC;aACrH;iBAAM,IAAI,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC,EAAE;gBAC3C,QAAQ,GAAG,QAAQ,CAAC,MAAM,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC,GAAG,CAAC,CAAC,GAAW,EAAE,EAAE,CAAC,GAAG,SAAS,GAAG,SAAS,KAAK,GAAG,EAAE,CAAC,CAAC,CAAC;aACxG;iBAAM,IAAI,OAAO,MAAM,CAAC,SAAS,CAAC,KAAK,QAAQ,EAAE;gBAChD,QAAQ,GAAG,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,SAAS,CAAC,EAAE,SAAS,GAAG,SAAS,GAAG,GAAG,CAAC,CAAC,CAAC;aAChG;SACF;QACD,OAAO,QAAQ,CAAC;IAClB,CAAC;CACF;AAED,kBAAe,gBAAgB,CAAC","sourcesContent":["import { ClientRequest, IncomingMessage } from 'http';\n\n/** An Discord error from a request. */\nclass DiscordRESTError extends Error {\n  /** The client request of the error. */\n  readonly req: ClientRequest;\n  /** The response from the server. */\n  readonly res: IncomingMessage;\n  /** The response class from a {@link Server}. */\n  readonly response: any;\n  /** The error code from the response. */\n  readonly status: number;\n  /** The error code from Discord. */\n  readonly code: number;\n  /** The message of the error. */\n  readonly message: string;\n  /** The error stack. */\n  readonly stack: string;\n\n  /**\n   * @param req A client request\n   * @param res An incoming message from the server\n   * @param response Any {@link Server}s response class\n   * @param stack The error stack\n   */\n  constructor(req: ClientRequest, res: IncomingMessage, response: any, stack: string) {\n    super();\n\n    this.req = req;\n    this.res = res;\n    this.response = response;\n    this.status = res.statusCode as number;\n    this.code = (response.code as number) || 0;\n\n    let message = response.message || 'Unknown error';\n    if (response.errors) message += '\\n  ' + this.flattenErrors(response.errors).join('\\n  ');\n    else {\n      const errors = this.flattenErrors(response);\n      if (errors.length > 0) message += '\\n  ' + errors.join('\\n  ');\n    }\n    this.message = message;\n\n    if (stack) this.stack = this.name + ': ' + this.message + '\\n' + stack;\n    else {\n      // Set stack before capturing to avoid TS error\n      this.stack = '';\n      Error.captureStackTrace(this, DiscordRESTError);\n    }\n  }\n\n  get name() {\n    return `${this.constructor.name} [${this.code}]`;\n  }\n\n  private flattenErrors(errors: any, keyPrefix = '') {\n    let messages: string[] = [];\n    for (const fieldName in errors) {\n      if (!(fieldName in errors) || fieldName === 'message' || fieldName === 'code') {\n        continue;\n      }\n      if (errors[fieldName]._errors) {\n        messages = messages.concat(errors[fieldName]._errors.map((obj: any) => `${keyPrefix + fieldName}: ${obj.message}`));\n      } else if (Array.isArray(errors[fieldName])) {\n        messages = messages.concat(errors[fieldName].map((str: string) => `${keyPrefix + fieldName}: ${str}`));\n      } else if (typeof errors[fieldName] === 'object') {\n        messages = messages.concat(this.flattenErrors(errors[fieldName], keyPrefix + fieldName + '.'));\n      }\n    }\n    return messages;\n  }\n}\n\nexport default DiscordRESTError;\n"]}